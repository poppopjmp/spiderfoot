# =============================================================================
# SpiderFoot Microservices — Environment Configuration
# =============================================================================
# Copy to .env in the project root before running docker compose.
#
#   cp docker/env.example .env
#   docker compose -f docker-compose.yml up --build -d
#
# Variables are grouped by subsystem.  Defaults are sane for local dev;
# override only what you need.
# =============================================================================

# ---------------------------------------------------------------------------
# PostgreSQL
# ---------------------------------------------------------------------------
POSTGRES_DB=spiderfoot
POSTGRES_USER=spiderfoot
POSTGRES_PASSWORD=changeme

# ---------------------------------------------------------------------------
# Redis
# ---------------------------------------------------------------------------
# REDIS_PASSWORD=               # Set if Redis auth is needed

# ---------------------------------------------------------------------------
# SpiderFoot — Scanner
# ---------------------------------------------------------------------------
SF_SCANNER_MAX_SCANS=3          # Max concurrent scans
SF_WORKER_MAX=8                 # Worker threads per scan
SF_WORKER_STRATEGY=thread       # thread | process

# ---------------------------------------------------------------------------
# SpiderFoot — API (FastAPI)
# ---------------------------------------------------------------------------
SF_API_WORKERS=4
SF_API_KEY=                     # Optional API auth key
SF_LOG_LEVEL=INFO               # DEBUG | INFO | WARNING | ERROR

# ---------------------------------------------------------------------------
# SpiderFoot — Web UI (CherryPy)
# ---------------------------------------------------------------------------
# (No special env vars — inherits SF_LOG_LEVEL and SF_API_KEY)

# ---------------------------------------------------------------------------
# Traefik — Reverse Proxy / API Gateway  (replaces Nginx since v5.3.17)
# ---------------------------------------------------------------------------
# All services are behind HTTPS.  Self-signed certs for dev (auto-generated).
# For Let's Encrypt, see infra/traefik/traefik.yml.
SF_HTTP_PORT=80                 # HTTP (redirects to HTTPS)
SF_HTTPS_PORT=443               # HTTPS entry point
# Dashboard basic auth (default: admin / spiderfoot)
# Generate new hash: htpasswd -nB admin
# TRAEFIK_DASHBOARD_USER=admin
# TRAEFIK_DASHBOARD_PASS=$$2y$$05$$...

# ---------------------------------------------------------------------------
# Apache Tika — Document Analysis  (new in v5.3.17)
# ---------------------------------------------------------------------------
# Full Tika image with OCR support (Tesseract).
# Used by the sfp_document_analyzer scan module.
TIKA_HEAP=512m                  # JVM heap for Tika
TIKA_CPUS=2.0
TIKA_MEMORY=1G

# ---------------------------------------------------------------------------
# MinIO — S3-compatible Object Storage
# ---------------------------------------------------------------------------
MINIO_ROOT_USER=spiderfoot
MINIO_ROOT_PASSWORD=changeme123
# SF_MINIO_CONSOLE_URL=https://localhost/minio/
# Bucket overrides (created automatically by minio-init)
# SF_MINIO_REPORTS_BUCKET=sf-reports
# SF_MINIO_DATA_BUCKET=sf-data
# SF_MINIO_LOGS_BUCKET=sf-logs

# ---------------------------------------------------------------------------
# Qdrant — Vector Database
# ---------------------------------------------------------------------------
# SF_QDRANT_HOST=qdrant        # (internal, no override needed usually)
# SF_QDRANT_PORT=6333
# SF_QDRANT_GRPC_PORT=6334
QDRANT_CPUS=1.0
QDRANT_MEMORY=1G

# ---------------------------------------------------------------------------
# Embedding Model (for vector correlations)
# ---------------------------------------------------------------------------
SF_EMBEDDING_PROVIDER=mock      # mock | openai | huggingface | sentence-transformers
SF_EMBEDDING_MODEL=all-MiniLM-L6-v2
SF_EMBEDDING_DIMENSIONS=384
SF_EMBEDDING_API_KEY=
SF_EMBEDDING_API_BASE=

# ---------------------------------------------------------------------------
# Reranker (for RAG result quality)
# ---------------------------------------------------------------------------
SF_RERANKER_PROVIDER=mock       # mock | cohere | sentence-transformers
SF_RERANKER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
SF_RERANKER_API_KEY=
SF_RERANKER_TOP_K=10
SF_RERANKER_SCORE_THRESHOLD=0.3

# ---------------------------------------------------------------------------
# Vector Correlation
# ---------------------------------------------------------------------------
SF_VECTOR_CORRELATION_ENABLED=true
SF_VECTOR_SIMILARITY_THRESHOLD=0.7
SF_VECTOR_CROSS_SCAN_THRESHOLD=0.8
SF_VECTOR_RERANK_ACCURACY=high

# ---------------------------------------------------------------------------
# LiteLLM Proxy — Unified LLM Gateway
# ---------------------------------------------------------------------------
# Accessible at https://localhost/litellm/
# SF_LITELLM_PORT=4000          # internal port (not exposed to host)
LITELLM_MASTER_KEY=sk-sf-litellm-dev-key

# Provider API keys (set whichever you use)
OPENAI_API_KEY=
ANTHROPIC_API_KEY=
OPENROUTER_API_KEY=
OLLAMA_API_BASE=http://host.docker.internal:11434

# SpiderFoot LLM settings (routed through LiteLLM)
SF_LLM_PROVIDER=mock            # mock | openai | anthropic | openrouter | ollama
SF_LLM_MODEL=                   # e.g. gpt-4o-mini, claude-3-haiku, etc.
SF_LLM_API_BASE=http://litellm:4000
SF_LLM_API_KEY=sk-sf-litellm-dev-key

# ---------------------------------------------------------------------------
# AI Agents
# ---------------------------------------------------------------------------
SF_AGENTS_WORKERS=1
# Accessible at https://localhost/api/agents/

# ---------------------------------------------------------------------------
# Monitoring — Grafana  (https://localhost/grafana/)
# ---------------------------------------------------------------------------
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=spiderfoot
# GF_SERVER_ROOT_URL=https://localhost/grafana/

# ---------------------------------------------------------------------------
# Monitoring — Prometheus  (https://localhost/prometheus/)
# ---------------------------------------------------------------------------
# No direct port — accessed via Traefik

# ---------------------------------------------------------------------------
# Monitoring — Loki (log aggregation)
# ---------------------------------------------------------------------------
SF_LOKI_ENDPOINT=http://loki:3100

# ---------------------------------------------------------------------------
# Monitoring — Jaeger  (https://localhost/jaeger/)
# ---------------------------------------------------------------------------
# No direct port — accessed via Traefik

# ---------------------------------------------------------------------------
# Vector.dev — Telemetry Pipeline
# ---------------------------------------------------------------------------
# SF_VECTOR_HTTP_PORT=8686      # HTTP source for scan events
# SF_ALERT_WEBHOOK_URL=         # High-severity alert webhook

# ---------------------------------------------------------------------------
# PostgreSQL Backup Sidecar
# ---------------------------------------------------------------------------
SF_PG_BACKUP_SCHEDULE=6         # Hours between backups
SF_PG_BACKUP_RETENTION=30       # Days to retain backups

# ---------------------------------------------------------------------------
# Resource Limits (Docker deploy)
# ---------------------------------------------------------------------------
SCANNER_CPUS=4.0
SCANNER_MEMORY=4G
API_CPUS=2.0
API_MEMORY=2G
WEBUI_CPUS=1.0
WEBUI_MEMORY=1G
AGENTS_CPUS=2.0
AGENTS_MEMORY=2G
TRAEFIK_CPUS=0.5
TRAEFIK_MEMORY=128M
MINIO_CPUS=1.0
MINIO_MEMORY=512M
VECTOR_CPUS=0.5
VECTOR_MEMORY=256M
LOKI_CPUS=1.0
LOKI_MEMORY=512M
GRAFANA_CPUS=1.0
GRAFANA_MEMORY=512M
PROMETHEUS_CPUS=1.0
PROMETHEUS_MEMORY=512M
JAEGER_CPUS=1.0
JAEGER_MEMORY=512M
LITELLM_CPUS=1.0
LITELLM_MEMORY=512M

