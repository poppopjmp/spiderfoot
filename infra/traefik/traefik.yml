# =============================================================================
# Traefik Static Configuration — SpiderFoot Microservices
# =============================================================================
# Traefik replaces Nginx as the reverse-proxy / API gateway.
# Routing is defined via Docker labels on each service in docker-compose.
#
# All traffic is HTTPS (port 443) with automatic HTTP→HTTPS redirect.
# Self-signed certs for dev; Let's Encrypt option below for production.
#
# Dashboard:  https://localhost/dashboard/
# Web entry:  https://localhost (port 443)
# =============================================================================

# --- Entrypoints ---
entryPoints:
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
          permanent: true
  websecure:
    address: ":443"
    http:
      tls: {}

# --- API / Dashboard ---
api:
  dashboard: true
  # Dashboard is served via an internal router (see dynamic.yml)
  # No insecure port — everything goes through HTTPS

# --- Docker provider ---
providers:
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false          # Only route containers with traefik.enable=true
    network: "sf-frontend"           # Default Docker network for routing
  file:
    filename: "/etc/traefik/dynamic.yml"
    watch: true

# --- Logging ---
log:
  level: "INFO"                       # DEBUG | INFO | WARN | ERROR

accessLog:
  filePath: "/var/log/traefik/access.log"
  bufferingSize: 100
  filters:
    statusCodes:
      - "400-599"

# --- Health check ---
ping:
  entryPoint: "web"

# --- Metrics (Prometheus) ---
metrics:
  prometheus:
    entryPoint: "websecure"
    addEntryPointsLabels: true
    addServicesLabels: true
    addRoutersLabels: true

# --- Optional: Let's Encrypt ACME ---
# Uncomment below and set your email.  Remove the tls.certificates section
# from dynamic.yml when using ACME.
# certificatesResolvers:
#   letsencrypt:
#     acme:
#       email: "admin@example.com"
#       storage: "/letsencrypt/acme.json"
#       httpChallenge:
#         entryPoint: web
#       # tlsChallenge: {}    # Alternative: TLS-ALPN-01
