# =============================================================================
# SpiderFoot — Environment Configuration
# =============================================================================
# Copy this file to .env before running docker compose.
#
# Profiles control which services start:
#   (no flag)           → 5 core services  (postgres, redis, api, worker, frontend)
#   --profile scan      → + active-scan worker
#   --profile proxy     → + Traefik reverse proxy + TLS
#   --profile storage   → + MinIO, Qdrant, Tika, pg-backup
#   --profile monitor   → + Vector, Loki, Grafana, Prometheus, Jaeger
#   --profile ai        → + AI agents + LiteLLM gateway
#   --profile scheduler → + Celery Beat + Flower
#   --profile sso       → + Keycloak (OIDC / SAML)
#   --profile full      → all of the above (except SSO)
#
# Quick start:
#   cp .env.example .env
#   docker compose -f docker-compose.yml up --build -d               # core
#   docker compose -f docker-compose.yml --profile full up --build -d # full
#
# ⚠️  SECURITY: Change ALL passwords and secrets before any non-local usage.
# =============================================================================

# ═══════════════════════════════════════════════════════════════════════════════
# CORE  (always needed — no profile flag required)
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# PostgreSQL
# ---------------------------------------------------------------------------
POSTGRES_DB=spiderfoot
POSTGRES_USER=spiderfoot
POSTGRES_PASSWORD=changeme           # ⚠️ Change this!

# ---------------------------------------------------------------------------
# SpiderFoot — Auth / RBAC
# ---------------------------------------------------------------------------
SF_JWT_SECRET=change-me-in-production-please   # ⚠️ Change this!
SF_ADMIN_USERNAME=admin
SF_ADMIN_PASSWORD=admin              # ⚠️ Change this!
SF_ADMIN_EMAIL=admin@spiderfoot.local
SF_AUTH_REQUIRED=true
SF_RBAC_ENFORCE=true
SF_MAX_LOGIN_ATTEMPTS=5
SF_JWT_EXPIRY_HOURS=24
SF_JWT_REFRESH_EXPIRY_HOURS=168

# ---------------------------------------------------------------------------
# SpiderFoot — API (FastAPI)
# ---------------------------------------------------------------------------
SF_API_WORKERS=4
SF_API_KEY=                          # Optional API auth key
SF_LOG_LEVEL=INFO                    # DEBUG | INFO | WARNING | ERROR

# ---------------------------------------------------------------------------
# SpiderFoot — Scanner
# ---------------------------------------------------------------------------
SF_SCANNER_MAX_SCANS=3               # Max concurrent scans
SF_WORKER_MAX=8                      # Worker threads per scan
SF_WORKER_STRATEGY=thread            # thread | process

# ---------------------------------------------------------------------------
# Celery Workers
# ---------------------------------------------------------------------------
CELERY_WORKER_CONCURRENCY=4

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: proxy  (--profile proxy)
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# Traefik — Reverse Proxy / API Gateway
# ---------------------------------------------------------------------------
SF_HTTP_PORT=80                      # HTTP (redirects to HTTPS)
SF_HTTPS_PORT=443                    # HTTPS entry point

# SpiderFoot external URL — used to build OAuth2 redirect_uri.
# Must match what the browser sees (scheme + host).
SF_EXTERNAL_URL=https://localhost

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: storage  (--profile storage)
# Uncomment the lines below when enabling the storage profile.
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# MinIO — S3-compatible Object Storage
# ---------------------------------------------------------------------------
# MINIO_ROOT_USER=spiderfoot
# MINIO_ROOT_PASSWORD=changeme123    # ⚠️ Change this!
# SF_MINIO_ENDPOINT=minio:9000
# SF_MINIO_CONSOLE_URL=https://localhost/minio/

# ---------------------------------------------------------------------------
# Qdrant — Vector Database
# ---------------------------------------------------------------------------
# SF_QDRANT_BACKEND=http
# SF_QDRANT_HOST=qdrant
# SF_QDRANT_PORT=6333
# SF_QDRANT_GRPC_PORT=6334
# QDRANT_CPUS=1.0
# QDRANT_MEMORY=1G

# ---------------------------------------------------------------------------
# Apache Tika — Document Analysis
# ---------------------------------------------------------------------------
# SF_TIKA_URL=http://tika:9998
# TIKA_HEAP=512m
# TIKA_CPUS=2.0
# TIKA_MEMORY=1G

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: ai  (--profile ai)
# Uncomment the lines below when enabling the AI profile.
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# LiteLLM Proxy — Unified LLM Gateway
# ---------------------------------------------------------------------------
# LITELLM_MASTER_KEY=sk-sf-litellm-dev-key   # ⚠️ Change this!
# OPENAI_API_KEY=
# ANTHROPIC_API_KEY=
# OPENROUTER_API_KEY=
# OLLAMA_API_BASE=http://host.docker.internal:11434

# ---------------------------------------------------------------------------
# SpiderFoot LLM settings (routed through LiteLLM)
# ---------------------------------------------------------------------------
# SF_LLM_PROVIDER=openai             # mock | openai | anthropic | openrouter | ollama
# SF_LLM_MODEL=gpt-4o-mini           # e.g. gpt-4o-mini, claude-3-haiku, etc.
# SF_LLM_API_BASE=http://litellm:4000
# SF_LLM_API_KEY=sk-sf-litellm-dev-key

# ---------------------------------------------------------------------------
# Embedding Model (for vector correlations)
# ---------------------------------------------------------------------------
# SF_EMBEDDING_PROVIDER=litellm      # litellm | ollama | openai | sentence_transformer | mock
# SF_EMBEDDING_MODEL=text-embedding-3-small
# SF_EMBEDDING_DIMENSIONS=1536
# SF_EMBEDDING_API_BASE=http://litellm:4000

# ---------------------------------------------------------------------------
# Reranker (for RAG result quality)
# ---------------------------------------------------------------------------
# SF_RERANKER_PROVIDER=litellm       # litellm | ollama | cohere | jina | cross_encoder | mock
# SF_RERANKER_MODEL=gpt-4o-mini
# SF_RERANKER_API_BASE=http://litellm:4000
# SF_RERANKER_TOP_K=10
# SF_RERANKER_SCORE_THRESHOLD=0.3

# ---------------------------------------------------------------------------
# Vector Correlation (requires --profile storage for Qdrant)
# ---------------------------------------------------------------------------
# SF_VECTOR_CORRELATION_ENABLED=true
# SF_VECTOR_SIMILARITY_THRESHOLD=0.7
# SF_VECTOR_CROSS_SCAN_THRESHOLD=0.8
# SF_VECTOR_RERANK_ACCURACY=high

# ---------------------------------------------------------------------------
# AI Agents
# ---------------------------------------------------------------------------
# SF_AGENTS_WORKERS=1

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: monitor  (--profile monitor)
# Uncomment the lines below when enabling the monitoring profile.
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# Monitoring — OTEL / Vector.dev
# ---------------------------------------------------------------------------
# OTEL_EXPORTER_OTLP_ENDPOINT=http://vector:4317
# SF_VECTOR_URL=http://vector:8686

# ---------------------------------------------------------------------------
# Monitoring — Grafana  (https://localhost/grafana/)
# ---------------------------------------------------------------------------
# GF_SECURITY_ADMIN_USER=admin
# GF_SECURITY_ADMIN_PASSWORD=spiderfoot   # ⚠️ Change this!

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: scheduler  (--profile scheduler)
# Uncomment the lines below when enabling the scheduler profile.
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# Flower — Celery Monitoring  (https://localhost/flower/)
# ---------------------------------------------------------------------------
# FLOWER_BASIC_AUTH=admin:spiderfoot  # ⚠️ Change this!

# ═══════════════════════════════════════════════════════════════════════════════
# PROFILE: sso  (--profile sso)
# Uncomment the lines below when enabling the SSO profile.
# ═══════════════════════════════════════════════════════════════════════════════

# ---------------------------------------------------------------------------
# Keycloak — SSO / OIDC Identity Provider
# ---------------------------------------------------------------------------
# KC_PORT=9080                       # Host port for Keycloak
# KC_ADMIN_PASSWORD=admin            # ⚠️ Change this!
# KC_CPUS=1.0
# KC_MEMORY=768M

# ═══════════════════════════════════════════════════════════════════════════════
# RESOURCE LIMITS  (Docker deploy — all profiles)
# ═══════════════════════════════════════════════════════════════════════════════

API_CPUS=2.0
API_MEMORY=2G
CELERY_WORKER_CPUS=2.0
CELERY_WORKER_MEMORY=2G
CELERY_ACTIVE_WORKER_CPUS=4.0
CELERY_ACTIVE_WORKER_MEMORY=4G
FRONTEND_CPUS=0.5
FRONTEND_MEMORY=128M
# TRAEFIK_CPUS=0.5
# TRAEFIK_MEMORY=128M
# MINIO_CPUS=1.0
# MINIO_MEMORY=512M
# VECTOR_CPUS=0.5
# VECTOR_MEMORY=256M
# LOKI_CPUS=1.0
# LOKI_MEMORY=512M
# GRAFANA_CPUS=1.0
# GRAFANA_MEMORY=512M
# PROMETHEUS_CPUS=1.0
# PROMETHEUS_MEMORY=512M
# JAEGER_CPUS=1.0
# JAEGER_MEMORY=512M
# LITELLM_CPUS=1.0
# LITELLM_MEMORY=1G
# AGENTS_CPUS=2.0
# AGENTS_MEMORY=2G

