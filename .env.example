# =============================================================================
# SpiderFoot Microservices — Environment Configuration
# =============================================================================
# Copy this file to .env in the project root before running docker compose:
#
#   cp .env.example .env
#   # Edit passwords/keys below, then:
#   docker compose -f docker-compose-microservices.yml up --build -d
#
# ⚠️  SECURITY: Change ALL passwords and secrets before any non-local usage.
# =============================================================================

# ---------------------------------------------------------------------------
# PostgreSQL
# ---------------------------------------------------------------------------
POSTGRES_DB=spiderfoot
POSTGRES_USER=spiderfoot
POSTGRES_PASSWORD=changeme           # ⚠️ Change this!

# ---------------------------------------------------------------------------
# Redis
# ---------------------------------------------------------------------------
# REDIS_PASSWORD=                    # Set if Redis auth is needed

# ---------------------------------------------------------------------------
# MinIO — S3-compatible Object Storage
# ---------------------------------------------------------------------------
MINIO_ROOT_USER=spiderfoot
MINIO_ROOT_PASSWORD=changeme123      # ⚠️ Change this!
# SF_MINIO_CONSOLE_URL=https://localhost/minio/
# SF_MINIO_REPORTS_BUCKET=sf-reports
# SF_MINIO_DATA_BUCKET=sf-data
# SF_MINIO_LOGS_BUCKET=sf-logs

# ---------------------------------------------------------------------------
# SpiderFoot — Auth / RBAC
# ---------------------------------------------------------------------------
SF_JWT_SECRET=change-me-in-production-please   # ⚠️ Change this!
SF_ADMIN_USERNAME=admin
SF_ADMIN_PASSWORD=admin              # ⚠️ Change this!
SF_ADMIN_EMAIL=admin@spiderfoot.local
SF_AUTH_REQUIRED=true
SF_RBAC_ENFORCE=true
SF_MAX_LOGIN_ATTEMPTS=5
SF_JWT_EXPIRY_HOURS=24
SF_JWT_REFRESH_EXPIRY_HOURS=168

# ---------------------------------------------------------------------------
# SpiderFoot — Scanner
# ---------------------------------------------------------------------------
SF_SCANNER_MAX_SCANS=3               # Max concurrent scans
SF_WORKER_MAX=8                      # Worker threads per scan
SF_WORKER_STRATEGY=thread            # thread | process

# ---------------------------------------------------------------------------
# SpiderFoot — API (FastAPI)
# ---------------------------------------------------------------------------
SF_API_WORKERS=4
SF_API_KEY=                          # Optional API auth key
SF_LOG_LEVEL=INFO                    # DEBUG | INFO | WARNING | ERROR

# ---------------------------------------------------------------------------
# Traefik — Reverse Proxy / API Gateway
# ---------------------------------------------------------------------------
SF_HTTP_PORT=80                      # HTTP (redirects to HTTPS)
SF_HTTPS_PORT=443                    # HTTPS entry point

# ---------------------------------------------------------------------------
# Apache Tika — Document Analysis
# ---------------------------------------------------------------------------
TIKA_HEAP=512m                       # JVM heap for Tika
TIKA_CPUS=2.0
TIKA_MEMORY=1G

# ---------------------------------------------------------------------------
# Qdrant — Vector Database
# ---------------------------------------------------------------------------
QDRANT_CPUS=1.0
QDRANT_MEMORY=1G

# ---------------------------------------------------------------------------
# Embedding Model (for vector correlations)
# ---------------------------------------------------------------------------
SF_EMBEDDING_PROVIDER=mock           # mock | openai | huggingface | sentence-transformers
SF_EMBEDDING_MODEL=all-MiniLM-L6-v2
SF_EMBEDDING_DIMENSIONS=384
SF_EMBEDDING_API_KEY=
SF_EMBEDDING_API_BASE=

# ---------------------------------------------------------------------------
# Reranker (for RAG result quality)
# ---------------------------------------------------------------------------
SF_RERANKER_PROVIDER=mock            # mock | cohere | sentence-transformers
SF_RERANKER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
SF_RERANKER_API_KEY=
SF_RERANKER_TOP_K=10
SF_RERANKER_SCORE_THRESHOLD=0.3

# ---------------------------------------------------------------------------
# Vector Correlation
# ---------------------------------------------------------------------------
SF_VECTOR_CORRELATION_ENABLED=true
SF_VECTOR_SIMILARITY_THRESHOLD=0.7
SF_VECTOR_CROSS_SCAN_THRESHOLD=0.8
SF_VECTOR_RERANK_ACCURACY=high

# ---------------------------------------------------------------------------
# LiteLLM Proxy — Unified LLM Gateway
# ---------------------------------------------------------------------------
LITELLM_MASTER_KEY=sk-sf-litellm-dev-key   # ⚠️ Change this in production!

# Provider API keys (set whichever you use)
OPENAI_API_KEY=
ANTHROPIC_API_KEY=
OPENROUTER_API_KEY=
OLLAMA_API_BASE=http://host.docker.internal:11434

# SpiderFoot LLM settings (routed through LiteLLM)
SF_LLM_PROVIDER=mock                # mock | openai | anthropic | openrouter | ollama
SF_LLM_MODEL=                       # e.g. gpt-4o-mini, claude-3-haiku, etc.
SF_LLM_API_BASE=http://litellm:4000
SF_LLM_API_KEY=sk-sf-litellm-dev-key

# ---------------------------------------------------------------------------
# AI Agents
# ---------------------------------------------------------------------------
SF_AGENTS_WORKERS=1

# ---------------------------------------------------------------------------
# Monitoring — Grafana  (https://localhost/grafana/)
# ---------------------------------------------------------------------------
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=spiderfoot   # ⚠️ Change this!

# ---------------------------------------------------------------------------
# Monitoring — Flower  (https://localhost/flower/)
# ---------------------------------------------------------------------------
FLOWER_BASIC_AUTH=admin:spiderfoot       # ⚠️ Change this!

# ---------------------------------------------------------------------------
# Celery Workers
# ---------------------------------------------------------------------------
CELERY_WORKER_CONCURRENCY=4

# ---------------------------------------------------------------------------
# Resource Limits (Docker deploy)
# ---------------------------------------------------------------------------
SCANNER_CPUS=4.0
SCANNER_MEMORY=4G
API_CPUS=2.0
API_MEMORY=2G
WEBUI_CPUS=1.0
WEBUI_MEMORY=1G
AGENTS_CPUS=2.0
AGENTS_MEMORY=2G
TRAEFIK_CPUS=0.5
TRAEFIK_MEMORY=128M
MINIO_CPUS=1.0
MINIO_MEMORY=512M
VECTOR_CPUS=0.5
VECTOR_MEMORY=256M
LOKI_CPUS=1.0
LOKI_MEMORY=512M
GRAFANA_CPUS=1.0
GRAFANA_MEMORY=512M
PROMETHEUS_CPUS=1.0
PROMETHEUS_MEMORY=512M
JAEGER_CPUS=1.0
JAEGER_MEMORY=512M
LITELLM_CPUS=1.0
LITELLM_MEMORY=1G
