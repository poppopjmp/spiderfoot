{"version":3,"file":"Users-C1JcJhqY.js","sources":["../../../../frontend/src/pages/Users.tsx"],"sourcesContent":["/**\r\n * SpiderFoot User Management Page (admin only)\r\n *\r\n * Full CRUD for users: list, create, edit role/status, change password, delete.\r\n * Only accessible to users with user:read permission.\r\n */\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  Users as UsersIcon,\r\n  Plus,\r\n  Pencil,\r\n  Trash2,\r\n  KeyRound,\r\n  Shield,\r\n  CheckCircle,\r\n  XCircle,\r\n  Lock,\r\n  Clock,\r\n  Search,\r\n  X,\r\n  AlertCircle,\r\n  ChevronDown,\r\n} from 'lucide-react';\r\nimport { clsx } from 'clsx';\r\nimport api from '../lib/api';\r\nimport { useAuthStore } from '../lib/auth';\r\n\r\n// ── Types ────────────────────────────────────────────────\r\n\r\ninterface UserRecord {\r\n  id: string;\r\n  username: string;\r\n  email: string;\r\n  role: string;\r\n  display_name: string;\r\n  auth_method: string;\r\n  status: string;\r\n  created_at: number;\r\n  updated_at: number;\r\n  last_login: number;\r\n  sso_provider_id: string;\r\n}\r\n\r\nconst ROLES = ['viewer', 'analyst', 'operator', 'admin'] as const;\r\nconst STATUSES = ['active', 'disabled', 'locked', 'pending'] as const;\r\n\r\nconst STATUS_ICON: Record<string, React.ReactNode> = {\r\n  active: <CheckCircle className=\"h-3.5 w-3.5 text-green-400\" />,\r\n  disabled: <XCircle className=\"h-3.5 w-3.5 text-dark-500\" />,\r\n  locked: <Lock className=\"h-3.5 w-3.5 text-red-400\" />,\r\n  pending: <Clock className=\"h-3.5 w-3.5 text-yellow-400\" />,\r\n};\r\n\r\nconst ROLE_BADGE_COLOR: Record<string, string> = {\r\n  admin: 'bg-red-500/15 text-red-400 border-red-500/30',\r\n  operator: 'bg-orange-500/15 text-orange-400 border-orange-500/30',\r\n  analyst: 'bg-blue-500/15 text-blue-400 border-blue-500/30',\r\n  viewer: 'bg-dark-600/50 text-dark-300 border-dark-600',\r\n};\r\n\r\n// ── Helpers ──────────────────────────────────────────────\r\n\r\nfunction formatDate(ts: number): string {\r\n  if (!ts) return '—';\r\n  return new Date(ts * 1000).toLocaleString();\r\n}\r\n\r\n// ── Component ────────────────────────────────────────────\r\n\r\nexport default function UsersPage() {\r\n  const { user: currentUser, hasPermission } = useAuthStore();\r\n\r\n  const canCreate = hasPermission('user:create');\r\n  const canUpdate = hasPermission('user:update');\r\n  const canDelete = hasPermission('user:delete');\r\n\r\n  const [users, setUsers] = useState<UserRecord[]>([]);\r\n  const [total, setTotal] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [search, setSearch] = useState('');\r\n\r\n  // Modals\r\n  const [showCreate, setShowCreate] = useState(false);\r\n  const [editUser, setEditUser] = useState<UserRecord | null>(null);\r\n  const [passwordUser, setPasswordUser] = useState<UserRecord | null>(null);\r\n  const [deleteUser, setDeleteUser] = useState<UserRecord | null>(null);\r\n\r\n  // ── Data fetching ──────────────────────────────────────\r\n\r\n  const fetchUsers = useCallback(async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const res = await api.get('/api/auth/users', {\r\n        params: { limit: 200, offset: 0 },\r\n      });\r\n      setUsers(res.data.items || []);\r\n      setTotal(res.data.total || 0);\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.detail || err.message || 'Failed to load users');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n  }, [fetchUsers]);\r\n\r\n  // ── Filter ─────────────────────────────────────────────\r\n\r\n  const filtered = users.filter((u) => {\r\n    if (!search) return true;\r\n    const q = search.toLowerCase();\r\n    return (\r\n      u.username.toLowerCase().includes(q) ||\r\n      u.email.toLowerCase().includes(q) ||\r\n      u.display_name.toLowerCase().includes(q) ||\r\n      u.role.toLowerCase().includes(q)\r\n    );\r\n  });\r\n\r\n  // ── Render ─────────────────────────────────────────────\r\n\r\n  return (\r\n    <div>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-white flex items-center gap-3\">\r\n            <UsersIcon className=\"h-7 w-7 text-spider-400\" />\r\n            User Management\r\n          </h1>\r\n          <p className=\"text-dark-400 text-sm mt-1\">\r\n            {total} user{total !== 1 ? 's' : ''} total\r\n          </p>\r\n        </div>\r\n        {canCreate && (\r\n          <button\r\n            onClick={() => setShowCreate(true)}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-spider-600 hover:bg-spider-500 text-white rounded-lg text-sm font-medium transition-colors\"\r\n          >\r\n            <Plus className=\"h-4 w-4\" />\r\n            Add User\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"relative mb-4\">\r\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500\" />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search users...\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          className=\"w-full pl-10 pr-10 py-2.5 bg-dark-800 border border-dark-700 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60\"\r\n        />\r\n        {search && (\r\n          <button\r\n            onClick={() => setSearch('')}\r\n            className=\"absolute right-3 top-1/2 -translate-y-1/2 text-dark-500 hover:text-dark-300\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Error */}\r\n      {error && (\r\n        <div className=\"mb-4 flex items-center gap-2 px-4 py-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm\">\r\n          <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Table */}\r\n      <div className=\"bg-dark-800 border border-dark-700 rounded-xl overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"border-b border-dark-700 text-dark-400 text-left\">\r\n                <th className=\"px-4 py-3 font-medium\">User</th>\r\n                <th className=\"px-4 py-3 font-medium\">Role</th>\r\n                <th className=\"px-4 py-3 font-medium\">Status</th>\r\n                <th className=\"px-4 py-3 font-medium\">Auth</th>\r\n                <th className=\"px-4 py-3 font-medium\">Last Login</th>\r\n                <th className=\"px-4 py-3 font-medium text-right\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {loading ? (\r\n                <tr>\r\n                  <td colSpan={6} className=\"px-4 py-12 text-center text-dark-500\">\r\n                    <div className=\"flex items-center justify-center gap-2\">\r\n                      <div className=\"animate-spin h-5 w-5 border-2 border-spider-500 border-t-transparent rounded-full\" />\r\n                      Loading users...\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ) : filtered.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={6} className=\"px-4 py-12 text-center text-dark-500\">\r\n                    {search ? 'No users match your search' : 'No users found'}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filtered.map((u) => (\r\n                  <tr\r\n                    key={u.id}\r\n                    className=\"border-b border-dark-700/50 hover:bg-dark-750 transition-colors\"\r\n                  >\r\n                    {/* User info */}\r\n                    <td className=\"px-4 py-3\">\r\n                      <div>\r\n                        <p className=\"text-white font-medium\">{u.display_name || u.username}</p>\r\n                        <p className=\"text-dark-500 text-xs\">{u.email || u.username}</p>\r\n                      </div>\r\n                    </td>\r\n                    {/* Role badge */}\r\n                    <td className=\"px-4 py-3\">\r\n                      <span\r\n                        className={clsx(\r\n                          'inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium border',\r\n                          ROLE_BADGE_COLOR[u.role] || ROLE_BADGE_COLOR.viewer,\r\n                        )}\r\n                      >\r\n                        <Shield className=\"h-3 w-3\" />\r\n                        {u.role}\r\n                      </span>\r\n                    </td>\r\n                    {/* Status */}\r\n                    <td className=\"px-4 py-3\">\r\n                      <div className=\"flex items-center gap-1.5\">\r\n                        {STATUS_ICON[u.status] || STATUS_ICON.pending}\r\n                        <span className=\"text-dark-300 capitalize\">{u.status}</span>\r\n                      </div>\r\n                    </td>\r\n                    {/* Auth method */}\r\n                    <td className=\"px-4 py-3 text-dark-400 capitalize\">{u.auth_method}</td>\r\n                    {/* Last login */}\r\n                    <td className=\"px-4 py-3 text-dark-400 text-xs\">\r\n                      {formatDate(u.last_login)}\r\n                    </td>\r\n                    {/* Actions */}\r\n                    <td className=\"px-4 py-3\">\r\n                      <div className=\"flex items-center justify-end gap-1\">\r\n                        {canUpdate && (\r\n                          <button\r\n                            onClick={() => setEditUser(u)}\r\n                            className=\"p-1.5 text-dark-500 hover:text-spider-400 hover:bg-dark-700 rounded-lg transition-colors\"\r\n                            title=\"Edit user\"\r\n                          >\r\n                            <Pencil className=\"h-3.5 w-3.5\" />\r\n                          </button>\r\n                        )}\r\n                        {canUpdate && (\r\n                          <button\r\n                            onClick={() => setPasswordUser(u)}\r\n                            className=\"p-1.5 text-dark-500 hover:text-yellow-400 hover:bg-dark-700 rounded-lg transition-colors\"\r\n                            title=\"Change password\"\r\n                          >\r\n                            <KeyRound className=\"h-3.5 w-3.5\" />\r\n                          </button>\r\n                        )}\r\n                        {canDelete && u.id !== currentUser?.id && (\r\n                          <button\r\n                            onClick={() => setDeleteUser(u)}\r\n                            className=\"p-1.5 text-dark-500 hover:text-red-400 hover:bg-dark-700 rounded-lg transition-colors\"\r\n                            title=\"Delete user\"\r\n                          >\r\n                            <Trash2 className=\"h-3.5 w-3.5\" />\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ── Create User Modal ── */}\r\n      {showCreate && (\r\n        <CreateUserModal\r\n          onClose={() => setShowCreate(false)}\r\n          onCreated={() => {\r\n            setShowCreate(false);\r\n            fetchUsers();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* ── Edit User Modal ── */}\r\n      {editUser && (\r\n        <EditUserModal\r\n          user={editUser}\r\n          onClose={() => setEditUser(null)}\r\n          onUpdated={() => {\r\n            setEditUser(null);\r\n            fetchUsers();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* ── Change Password Modal ── */}\r\n      {passwordUser && (\r\n        <ChangePasswordModal\r\n          user={passwordUser}\r\n          onClose={() => setPasswordUser(null)}\r\n          onChanged={() => {\r\n            setPasswordUser(null);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* ── Delete Confirmation Modal ── */}\r\n      {deleteUser && (\r\n        <DeleteUserModal\r\n          user={deleteUser}\r\n          onClose={() => setDeleteUser(null)}\r\n          onDeleted={() => {\r\n            setDeleteUser(null);\r\n            fetchUsers();\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n// ══════════════════════════════════════════════════════════\r\n// Modal Components\r\n// ══════════════════════════════════════════════════════════\r\n\r\nfunction ModalShell({\r\n  title,\r\n  onClose,\r\n  children,\r\n}: {\r\n  title: string;\r\n  onClose: () => void;\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm\" onClick={onClose} />\r\n      <div className=\"relative bg-dark-800 border border-dark-700 rounded-2xl p-6 max-w-lg w-full shadow-2xl animate-fade-in-up\">\r\n        <div className=\"flex items-center justify-between mb-5\">\r\n          <h2 className=\"text-lg font-bold text-white\">{title}</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-dark-500 hover:text-dark-300 transition-colors\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FormField({\r\n  label,\r\n  children,\r\n}: {\r\n  label: string;\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-1.5\">\r\n      <label className=\"block text-sm font-medium text-dark-300\">{label}</label>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst inputClass =\r\n  'w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60';\r\n\r\nconst selectClass =\r\n  'w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60 appearance-none';\r\n\r\n\r\n// ── Create User ──────────────────────────────────────────\r\n\r\nfunction CreateUserModal({\r\n  onClose,\r\n  onCreated,\r\n}: {\r\n  onClose: () => void;\r\n  onCreated: () => void;\r\n}) {\r\n  const [username, setUsername] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [role, setRole] = useState('viewer');\r\n  const [displayName, setDisplayName] = useState('');\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setError('');\r\n    try {\r\n      await api.post('/api/auth/users', {\r\n        username,\r\n        email,\r\n        password,\r\n        role,\r\n        display_name: displayName,\r\n      });\r\n      onCreated();\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.detail || 'Failed to create user');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ModalShell title=\"Create User\" onClose={onClose}>\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm\">\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <FormField label=\"Username\">\r\n          <input\r\n            type=\"text\"\r\n            value={username}\r\n            onChange={(e) => setUsername(e.target.value)}\r\n            required\r\n            className={inputClass}\r\n            placeholder=\"e.g. john.doe\"\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Email\">\r\n          <input\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            required\r\n            className={inputClass}\r\n            placeholder=\"john@example.com\"\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Password\">\r\n          <input\r\n            type=\"password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            required\r\n            minLength={8}\r\n            className={inputClass}\r\n            placeholder=\"Min 8 characters\"\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Display Name\">\r\n          <input\r\n            type=\"text\"\r\n            value={displayName}\r\n            onChange={(e) => setDisplayName(e.target.value)}\r\n            className={inputClass}\r\n            placeholder=\"John Doe\"\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Role\">\r\n          <div className=\"relative\">\r\n            <select value={role} onChange={(e) => setRole(e.target.value)} className={selectClass}>\r\n              {ROLES.map((r) => (\r\n                <option key={r} value={r}>\r\n                  {r.charAt(0).toUpperCase() + r.slice(1)}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none\" />\r\n          </div>\r\n        </FormField>\r\n\r\n        <div className=\"flex justify-end gap-3 pt-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={saving}\r\n            className=\"px-4 py-2 bg-spider-600 hover:bg-spider-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors\"\r\n          >\r\n            {saving ? 'Creating...' : 'Create User'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </ModalShell>\r\n  );\r\n}\r\n\r\n\r\n// ── Edit User ────────────────────────────────────────────\r\n\r\nfunction EditUserModal({\r\n  user,\r\n  onClose,\r\n  onUpdated,\r\n}: {\r\n  user: UserRecord;\r\n  onClose: () => void;\r\n  onUpdated: () => void;\r\n}) {\r\n  const [email, setEmail] = useState(user.email);\r\n  const [role, setRole] = useState(user.role);\r\n  const [displayName, setDisplayName] = useState(user.display_name);\r\n  const [status, setStatus] = useState(user.status);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setError('');\r\n    try {\r\n      await api.patch(`/api/auth/users/${user.id}`, {\r\n        email,\r\n        role,\r\n        display_name: displayName,\r\n        status,\r\n      });\r\n      onUpdated();\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.detail || 'Failed to update user');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ModalShell title={`Edit ${user.username}`} onClose={onClose}>\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm\">\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <FormField label=\"Email\">\r\n          <input\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            className={inputClass}\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Display Name\">\r\n          <input\r\n            type=\"text\"\r\n            value={displayName}\r\n            onChange={(e) => setDisplayName(e.target.value)}\r\n            className={inputClass}\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Role\">\r\n          <div className=\"relative\">\r\n            <select value={role} onChange={(e) => setRole(e.target.value)} className={selectClass}>\r\n              {ROLES.map((r) => (\r\n                <option key={r} value={r}>\r\n                  {r.charAt(0).toUpperCase() + r.slice(1)}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none\" />\r\n          </div>\r\n        </FormField>\r\n\r\n        <FormField label=\"Status\">\r\n          <div className=\"relative\">\r\n            <select value={status} onChange={(e) => setStatus(e.target.value)} className={selectClass}>\r\n              {STATUSES.map((s) => (\r\n                <option key={s} value={s}>\r\n                  {s.charAt(0).toUpperCase() + s.slice(1)}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none\" />\r\n          </div>\r\n        </FormField>\r\n\r\n        <div className=\"text-xs text-dark-500 space-y-1\">\r\n          <p>Auth method: <span className=\"text-dark-300\">{user.auth_method}</span></p>\r\n          <p>Created: <span className=\"text-dark-300\">{formatDate(user.created_at)}</span></p>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end gap-3 pt-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={saving}\r\n            className=\"px-4 py-2 bg-spider-600 hover:bg-spider-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors\"\r\n          >\r\n            {saving ? 'Saving...' : 'Save Changes'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </ModalShell>\r\n  );\r\n}\r\n\r\n\r\n// ── Change Password ──────────────────────────────────────\r\n\r\nfunction ChangePasswordModal({\r\n  user,\r\n  onClose,\r\n  onChanged,\r\n}: {\r\n  user: UserRecord;\r\n  onClose: () => void;\r\n  onChanged: () => void;\r\n}) {\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirm, setConfirm] = useState('');\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (newPassword !== confirm) {\r\n      setError('Passwords do not match');\r\n      return;\r\n    }\r\n    setSaving(true);\r\n    setError('');\r\n    try {\r\n      await api.post(`/api/auth/users/${user.id}/password`, {\r\n        new_password: newPassword,\r\n      });\r\n      onChanged();\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.detail || 'Failed to change password');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ModalShell title={`Change Password — ${user.username}`} onClose={onClose}>\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm\">\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <FormField label=\"New Password\">\r\n          <input\r\n            type=\"password\"\r\n            value={newPassword}\r\n            onChange={(e) => setNewPassword(e.target.value)}\r\n            required\r\n            minLength={8}\r\n            className={inputClass}\r\n            placeholder=\"Min 8 characters\"\r\n          />\r\n        </FormField>\r\n\r\n        <FormField label=\"Confirm Password\">\r\n          <input\r\n            type=\"password\"\r\n            value={confirm}\r\n            onChange={(e) => setConfirm(e.target.value)}\r\n            required\r\n            minLength={8}\r\n            className={inputClass}\r\n            placeholder=\"Re-enter password\"\r\n          />\r\n        </FormField>\r\n\r\n        <div className=\"flex justify-end gap-3 pt-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={saving || newPassword.length < 8 || newPassword !== confirm}\r\n            className=\"px-4 py-2 bg-yellow-600 hover:bg-yellow-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors\"\r\n          >\r\n            {saving ? 'Changing...' : 'Change Password'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </ModalShell>\r\n  );\r\n}\r\n\r\n\r\n// ── Delete Confirmation ──────────────────────────────────\r\n\r\nfunction DeleteUserModal({\r\n  user,\r\n  onClose,\r\n  onDeleted,\r\n}: {\r\n  user: UserRecord;\r\n  onClose: () => void;\r\n  onDeleted: () => void;\r\n}) {\r\n  const [deleting, setDeleting] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleDelete = async () => {\r\n    setDeleting(true);\r\n    setError('');\r\n    try {\r\n      await api.delete(`/api/auth/users/${user.id}`);\r\n      onDeleted();\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.detail || 'Failed to delete user');\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ModalShell title=\"Delete User\" onClose={onClose}>\r\n      <div className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm\">\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <p className=\"text-dark-300 text-sm\">\r\n          Are you sure you want to delete user{' '}\r\n          <span className=\"text-white font-medium\">{user.username}</span>? This\r\n          action cannot be undone and will revoke all active sessions.\r\n        </p>\r\n\r\n        <div className=\"flex justify-end gap-3 pt-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleDelete}\r\n            disabled={deleting}\r\n            className=\"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors\"\r\n          >\r\n            {deleting ? 'Deleting...' : 'Delete User'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </ModalShell>\r\n  );\r\n}\r\n"],"names":["ROLES","STATUSES","STATUS_ICON","jsx","CheckCircle","XCircle","Lock","Clock","ROLE_BADGE_COLOR","formatDate","ts","UsersPage","currentUser","hasPermission","useAuthStore","canCreate","canUpdate","canDelete","users","setUsers","useState","total","setTotal","loading","setLoading","error","setError","search","setSearch","showCreate","setShowCreate","editUser","setEditUser","passwordUser","setPasswordUser","deleteUser","setDeleteUser","fetchUsers","useCallback","res","api","err","_b","_a","useEffect","filtered","u","q","jsxs","UsersIcon","Plus","Search","e","X","AlertCircle","clsx","Shield","Pencil","KeyRound","Trash2","CreateUserModal","EditUserModal","ChangePasswordModal","DeleteUserModal","ModalShell","title","onClose","children","FormField","label","inputClass","selectClass","onCreated","username","setUsername","email","setEmail","password","setPassword","role","setRole","displayName","setDisplayName","saving","setSaving","handleSubmit","r","ChevronDown","user","onUpdated","status","setStatus","s","onChanged","newPassword","setNewPassword","confirm","setConfirm","onDeleted","deleting","setDeleting","handleDelete"],"mappings":"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"}