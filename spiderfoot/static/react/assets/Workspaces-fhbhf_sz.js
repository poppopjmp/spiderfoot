import{c as A,u as ne,r as m,a as I,b as N,j as e,X as z,B as O,C as re,d as le,T as G,e as ce,f as L,R as H,L as ie,S as Z,g as de,w as x,h as oe,i as V,P as xe,k as me,l as ue,m as pe,F as he,n as ge,s as Ne}from"./index-BafnK45h.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=A("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=A("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=A("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=A("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=A("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=A("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),fe=[{label:"Auto-detect",value:""},{label:"Domain",value:"INTERNET_NAME"},{label:"IP Address",value:"IP_ADDRESS"},{label:"IPv6 Address",value:"IPV6_ADDRESS"},{label:"Subnet",value:"NETBLOCK_OWNER"},{label:"Email",value:"EMAILADDR"},{label:"Phone",value:"PHONE_NUMBER"},{label:"Username",value:"USERNAME"},{label:"Human Name",value:"HUMAN_NAME"},{label:"Bitcoin Address",value:"BITCOIN_ADDRESS"},{label:"ASN",value:"BGP_AS_OWNER"}];function be(c){const n=c.trim();return n?/^(1|3|bc1)[a-zA-HJ-NP-Z0-9]{25,62}$/.test(n)||/^(0x)?[0-9a-fA-F]{40}$/.test(n)?"BITCOIN_ADDRESS":/^(\d{1,3}\.){3}\d{1,3}(\/\d+)?$/.test(n)?n.includes("/")?"NETBLOCK_OWNER":"IP_ADDRESS":/^[a-f0-9:]+$/i.test(n)&&n.includes(":")?"IPV6_ADDRESS":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?"EMAILADDR":/^(\+?\d[\d\s-]{6,})$/.test(n)?"PHONE_NUMBER":/^AS\d+$/i.test(n)?"BGP_AS_OWNER":/^[a-zA-Z0-9][a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n)?"INTERNET_NAME":/^"[^"]+"$/.test(n)||/^@?[a-zA-Z0-9_]{1,30}$/.test(n)?"USERNAME":/\s/.test(n)?"HUMAN_NAME":"INTERNET_NAME":""}function Se(){const c=ne(),[n,u]=m.useState(!1),[w,p]=m.useState(!1),[F,j]=m.useState(!1),[t,_]=m.useState(null),[b,k]=m.useState({name:"",description:""}),[g,S]=m.useState({name:"",description:""}),[y,T]=m.useState({target:"",target_type:""}),[M,r]=m.useState(null),{data:a,isLoading:l}=I({queryKey:["workspaces"],queryFn:()=>x.list()}),h=(a==null?void 0:a.items)??[],{data:d}=I({queryKey:["workspace",t],queryFn:()=>x.get(t),enabled:!!t}),{data:C}=I({queryKey:["workspace-targets",t],queryFn:()=>x.targets(t),enabled:!!t}),{data:v}=I({queryKey:["workspace-summary",t],queryFn:()=>x.summary(t),enabled:!!t}),{data:P}=I({queryKey:["scans",{page:1,page_size:200}],queryFn:()=>Ne.list({page:1,page_size:200})}),q=(P==null?void 0:P.items)??[],W=N({mutationFn:x.create,onSuccess:()=>{c.invalidateQueries({queryKey:["workspaces"]}),u(!1),k({name:"",description:""}),r({type:"success",message:"Workspace created"})},onError:()=>{r({type:"error",message:"Failed to create workspace"})}}),Y=N({mutationFn:s=>x.delete(s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspaces"]}),t&&_(null),r({type:"success",message:"Workspace deleted"})},onError:()=>r({type:"error",message:"Failed to delete workspace"})}),ee=N({mutationFn:s=>x.clone(s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspaces"]}),r({type:"success",message:"Workspace cloned"})},onError:()=>r({type:"error",message:"Failed to clone workspace"})}),se=N({mutationFn:s=>x.setActive(s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspaces"]}),r({type:"success",message:"Workspace set as active"})},onError:()=>r({type:"error",message:"Failed to set active workspace"})}),$=N({mutationFn:({id:s,data:i})=>x.update(s,i),onSuccess:()=>{c.invalidateQueries({queryKey:["workspaces"]}),c.invalidateQueries({queryKey:["workspace",t]}),p(!1),r({type:"success",message:"Workspace updated"})}}),U=N({mutationFn:s=>x.addTarget(t,s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspace-targets",t]}),c.invalidateQueries({queryKey:["workspace-summary",t]}),T({target:"",target_type:""}),r({type:"success",message:"Target added"})},onError:()=>r({type:"error",message:"Failed to add target. Check the target value and type."})}),te=N({mutationFn:s=>x.deleteTarget(t,s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspace-targets",t]}),c.invalidateQueries({queryKey:["workspace-summary",t]}),r({type:"success",message:"Target removed"})},onError:()=>r({type:"error",message:"Failed to remove target"})}),K=N({mutationFn:s=>x.multiScan(t,s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspace-summary",t]}),c.invalidateQueries({queryKey:["scans"]}),j(!1),r({type:"success",message:"Workspace scan launched! Scans will appear below once started."})},onError:()=>r({type:"error",message:"Failed to launch workspace scan"})}),Q=N({mutationFn:s=>x.linkScan(t,s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspace",t]}),c.invalidateQueries({queryKey:["workspace-summary",t]}),r({type:"success",message:"Scan linked to workspace"})},onError:()=>r({type:"error",message:"Failed to link scan"})}),ae=N({mutationFn:s=>x.unlinkScan(t,s),onSuccess:()=>{c.invalidateQueries({queryKey:["workspace",t]}),c.invalidateQueries({queryKey:["workspace-summary",t]}),r({type:"success",message:"Scan unlinked from workspace"})},onError:()=>r({type:"error",message:"Failed to unlink scan"})}),E=(C==null?void 0:C.items)??[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Workspaces"}),e.jsxs("button",{className:"btn-primary flex items-center gap-2",onClick:()=>u(!0),children:[e.jsx(X,{className:"h-4 w-4"})," New Workspace"]})]}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>u(!1)}),e.jsxs("div",{className:"relative bg-dark-800 border border-dark-700 rounded-2xl p-6 max-w-md w-full shadow-2xl animate-fade-in-up",children:[e.jsx("button",{onClick:()=>u(!1),className:"absolute top-4 right-4 text-dark-500 hover:text-dark-300",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create Workspace"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-300 mb-1",children:"Workspace Name"}),e.jsx("input",{className:"input-field w-full",value:b.name,onChange:s=>k({...b,name:s.target.value}),placeholder:"e.g. Project Alpha"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-300 mb-1",children:"Description"}),e.jsx("textarea",{className:"input-field w-full h-20",value:b.description,onChange:s=>k({...b,description:s.target.value}),placeholder:"Describe this workspace..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",disabled:!b.name||W.isPending,onClick:()=>W.mutate(b),children:W.isPending?"Creating...":"Create"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[l&&e.jsx("p",{className:"text-dark-400",children:"Loading workspaces..."}),h.map(s=>e.jsxs("div",{className:`card cursor-pointer transition-colors border ${t===s.workspace_id?"border-spider-600 bg-dark-800/80":"border-transparent hover:border-dark-600"}`,onClick:()=>_(s.workspace_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-spider-600/20 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-spider-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.name}),e.jsx("p",{className:"text-xs text-dark-400",children:s.description||"No description"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"text-dark-400 hover:text-dark-200 p-1",title:"Edit",onClick:i=>{i.stopPropagation(),_(s.workspace_id),S({name:s.name,description:s.description||""}),p(!0)},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-green-400 hover:text-green-300 p-1",title:"Set as active",onClick:i=>{i.stopPropagation(),se.mutate(s.workspace_id)},children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-blue-400 hover:text-blue-300 p-1",title:"Clone",onClick:i=>{i.stopPropagation(),ee.mutate(s.workspace_id)},children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-red-400 hover:text-red-300 p-1",title:"Delete",onClick:i=>{i.stopPropagation(),confirm(`Delete workspace "${s.name}"?`)&&Y.mutate(s.workspace_id)},children:e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs text-dark-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"})," ",L(s.created_time)]}),s.target_count!=null&&e.jsxs("span",{children:[s.target_count," targets"]}),s.scan_count!=null&&e.jsxs("span",{children:[s.scan_count," scans"]})]})]},s.workspace_id)),!l&&h.length===0&&e.jsxs("div",{className:"card text-center py-8",children:[e.jsx(je,{className:"h-12 w-12 text-dark-600 mx-auto mb-3"}),e.jsx("p",{className:"text-dark-400",children:"No workspaces yet. Create one to get started."})]})]}),e.jsx("div",{className:"lg:col-span-2",children:t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>{const s=h.find(i=>i.workspace_id===t);s&&(S({name:s.name,description:s.description||""}),p(!0))},children:[e.jsx(J,{className:"h-3.5 w-3.5"})," Edit"]}),e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>j(!0),children:[e.jsx(D,{className:"h-3.5 w-3.5"})," Link Scan"]}),e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>{if(E.length===0){r({type:"error",message:"Add targets first"});return}const s=[];K.mutate(s)},disabled:E.length===0||K.isPending,children:[e.jsx(H,{className:"h-3.5 w-3.5"})," ",K.isPending?"Launching...":"Launch Scan"]})]}),v&&(()=>{var i;const s=((i=v==null?void 0:v.summary)==null?void 0:i.statistics)??v;return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Targets"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.target_count??E.length})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Scans"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.scan_count??0})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Events"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.total_events??0})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Correlations"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.correlation_count??0})]})]})})(),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Targets"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsx("input",{className:"input-field flex-1 min-w-0",value:y.target,onChange:s=>T({...y,target:s.target.value}),placeholder:"e.g. example.com, 192.168.1.0/24"}),e.jsx("select",{className:"input-field sm:w-48",value:y.target_type,onChange:s=>T({...y,target_type:s.target.value}),children:fe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("button",{className:"btn-primary flex items-center gap-2",disabled:!y.target||U.isPending,onClick:()=>{const s=y.target_type||be(y.target);if(!s){r({type:"error",message:"Cannot detect target type. Please select one."});return}U.mutate({target:y.target.trim(),target_type:s})},children:[e.jsx(X,{className:"h-4 w-4"})," Add"]})]}),E.length>0?e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-4 w-4 text-spider-400"}),e.jsx("span",{className:"text-white text-sm font-mono",children:s.value}),e.jsx("span",{className:"badge badge-info text-xs",children:s.type})]}),e.jsx("button",{className:"text-red-400 hover:text-red-300",onClick:()=>te.mutate(s.target_id),children:e.jsx(G,{className:"h-3.5 w-3.5"})})]},s.target_id))}):e.jsx("p",{className:"text-dark-400 text-sm",children:"No targets in this workspace."})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Linked Scans"}),e.jsxs("button",{className:"btn-secondary text-sm flex items-center gap-2",onClick:()=>j(!0),children:[e.jsx(D,{className:"h-3.5 w-3.5"})," Link Scan"]})]}),(()=>{const s=new Set(((d==null?void 0:d.scans)??[]).map(o=>o.scan_id)),i=q.filter(o=>!s.has(o.scan_id)&&E.some(R=>o.target===R.value)),B=[...q.filter(o=>s.has(o.scan_id)),...i];return B.length===0?e.jsx("p",{className:"text-dark-400 text-sm",children:'No scans linked. Use "Link Scan" to associate existing scans for cross-scan correlation.'}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:B.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-700/50 rounded-lg hover:bg-dark-700 transition-colors",children:[e.jsxs(ie,{to:`/scans/${o.scan_id}`,className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(H,{className:"h-4 w-4 text-spider-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:o.name||"Untitled"}),e.jsx("p",{className:"text-xs text-dark-500 font-mono",children:o.target})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{status:o.status??""}),e.jsx("span",{className:"text-xs text-dark-500 whitespace-nowrap",children:L(o.started??0)}),s.has(o.scan_id)?e.jsx("button",{className:"text-red-400 hover:text-red-300 p-1",title:"Unlink scan from workspace",onClick:R=>{R.preventDefault(),ae.mutate(o.scan_id)},children:e.jsx(ye,{className:"h-3.5 w-3.5"})}):e.jsx("button",{className:"text-spider-400 hover:text-spider-300 p-1",title:"Link scan to workspace",onClick:R=>{R.preventDefault(),Q.mutate(o.scan_id)},children:e.jsx(D,{className:"h-3.5 w-3.5"})})]})]},o.scan_id))})})()]}),d&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Workspace Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"ID"}),e.jsx("p",{className:"text-white font-mono text-xs",children:d.workspace_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Created"}),e.jsx("p",{className:"text-white",children:L(d.created_time)})]}),d.modified_time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Last Modified"}),e.jsx("p",{className:"text-white",children:L(d.modified_time)})]})]})]}),t&&e.jsx(ve,{workspaceId:t,workspace:h.find(s=>s.workspace_id===t),summary:v})]}):e.jsxs("div",{className:"card text-center py-16",children:[e.jsx(O,{className:"h-16 w-16 text-dark-600 mx-auto mb-4"}),e.jsx("p",{className:"text-dark-400 text-lg",children:"Select a workspace to view details"}),e.jsx("p",{className:"text-dark-500 text-sm mt-1",children:"Or create a new one to get started"})]})})]}),w&&t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>p(!1)}),e.jsxs("div",{className:"relative bg-dark-800 border border-dark-700 rounded-2xl p-6 max-w-md w-full shadow-2xl animate-fade-in-up",children:[e.jsx("button",{onClick:()=>p(!1),className:"absolute top-4 right-4 text-dark-500 hover:text-dark-300",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Workspace"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-300 mb-1",children:"Workspace Name"}),e.jsx("input",{className:"input-field w-full",value:g.name,onChange:s=>S({...g,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-300 mb-1",children:"Description"}),e.jsx("textarea",{className:"input-field w-full h-20",value:g.description,onChange:s=>S({...g,description:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",disabled:!g.name||$.isPending,onClick:()=>$.mutate({id:t,data:g}),children:$.isPending?"Saving...":"Save Changes"})]})]})]})]}),F&&t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>j(!1)}),e.jsxs("div",{className:"relative bg-dark-800 border border-dark-700 rounded-2xl p-6 max-w-lg w-full shadow-2xl animate-fade-in-up",children:[e.jsx("button",{onClick:()=>j(!1),className:"absolute top-4 right-4 text-dark-500 hover:text-dark-300",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Link Scans to Workspace"}),e.jsx("p",{className:"text-sm text-dark-400 mb-4",children:"Select existing scans to link for cross-scan correlation analysis."}),e.jsx("div",{className:"space-y-2 max-h-[350px] overflow-y-auto mb-4",children:q.length>0?(()=>{const s=new Set(((d==null?void 0:d.scans)??[]).map(f=>f.scan_id)),i=q.filter(f=>!s.has(f.scan_id));return i.length===0?e.jsx("p",{className:"text-dark-400 text-sm py-4 text-center",children:"All scans are already linked."}):i.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(H,{className:"h-4 w-4 text-spider-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:f.name||"Untitled"}),e.jsx("p",{className:"text-xs text-dark-500 font-mono",children:f.target})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{status:f.status??""}),e.jsxs("button",{className:"btn-secondary text-xs px-2 py-1 flex items-center gap-1",onClick:()=>Q.mutate(f.scan_id),disabled:Q.isPending,children:[e.jsx(D,{className:"h-3 w-3"})," Link"]})]})]},f.scan_id))})():e.jsx("p",{className:"text-dark-400 text-sm py-4 text-center",children:"No scans available. Run a scan first."})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn-secondary",onClick:()=>j(!1),children:"Done"})})]})]}),M&&e.jsx(de,{type:M.type,message:M.message,onClose:()=>r(null)})]})}function ve({workspaceId:c,workspace:n,summary:u}){const[w,p]=m.useState(""),[F,j]=m.useState(!1),[t,_]=m.useState(""),b=m.useRef(null),k=`sf_ws_report_${c}`;m.useEffect(()=>{const a=localStorage.getItem(k);p(a||"")},[k]);const g=N({mutationFn:async()=>oe.report({scan_id:c,target:(n==null?void 0:n.name)??"Workspace",stats:{workspace_id:c,workspace_name:n==null?void 0:n.name,...u??{}}}),onSuccess:a=>{const l=(a==null?void 0:a.report)??(a==null?void 0:a.content)??(a==null?void 0:a.markdown)??JSON.stringify(a,null,2);p(l),localStorage.setItem(k,l)}}),S=m.useCallback(()=>{const a=(u==null?void 0:u.summary)??u??{},l=(a==null?void 0:a.statistics)??a,d=[`# Workspace Report: ${(n==null?void 0:n.name)??"Unknown"}`,"",`**Workspace ID:** \`${c}\``,`**Description:** ${(n==null?void 0:n.description)||"N/A"}`,`**Generated:** ${new Date().toLocaleString()}`,"","---","","## Overview","",`- **Targets:** ${(l==null?void 0:l.target_count)??"N/A"}`,`- **Scans:** ${(l==null?void 0:l.scan_count)??"N/A"}`,`- **Total Events:** ${(l==null?void 0:l.total_events)??"N/A"}`,`- **Correlations:** ${(l==null?void 0:l.correlation_count)??"N/A"}`,"","## Analysis","","> *Edit this section to add your cross-scan threat analysis and insights.*","","## Recommendations","","1. Review all high-risk correlation findings across linked scans.","2. Identify patterns across multiple targets in this workspace.","3. Escalate critical findings to the security team.","","---","*Report generated by SpiderFoot Workspace Analyzer*"].join(`
`);p(d),localStorage.setItem(k,d)},[n,c,u,k]),y=()=>{_(w),j(!0),setTimeout(()=>{var a;return(a=b.current)==null?void 0:a.focus()},50)},T=()=>{p(t),localStorage.setItem(k,t),j(!1)},M=a=>a.split(`
`).map((l,h)=>{const d=l.match(/^(#{1,3})\s+(.*)/);if(d){const v=d[1].length,P=v===1?"text-lg font-bold text-white mt-3 mb-1":v===2?"text-base font-bold text-white mt-3 mb-1":"text-sm font-semibold text-white mt-2 mb-1";return e.jsx("div",{className:P,dangerouslySetInnerHTML:{__html:r(d[2])}},h)}if(/^---+$/.test(l.trim()))return e.jsx("hr",{className:"border-dark-700/50 my-3"},h);if(l.trim().startsWith(">"))return e.jsx("blockquote",{className:"border-l-2 border-spider-500 pl-3 text-dark-400 italic text-sm my-1",dangerouslySetInnerHTML:{__html:r(l.replace(/^>\s*/,""))}},h);const C=l.match(/^(\d+\.|[-*])\s+(.*)/);return C?e.jsx("li",{className:"text-sm text-dark-300 ml-4 list-disc",dangerouslySetInnerHTML:{__html:r(C[2])}},h):l.trim()===""?e.jsx("div",{className:"h-1"},h):e.jsx("p",{className:"text-sm text-dark-300",dangerouslySetInnerHTML:{__html:r(l)}},h)}),r=a=>a.replace(/\*\*(.+?)\*\*/g,'<strong class="text-white font-semibold">$1</strong>').replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/`(.+?)`/g,'<code class="bg-dark-700 px-1 py-0.5 rounded text-spider-400 text-xs font-mono">$1</code>');return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-spider-400"})," AI Report"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w&&!F&&e.jsxs("button",{className:"btn-secondary text-xs",onClick:y,children:[e.jsx(xe,{className:"h-3 w-3"})," Edit"]}),F&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-secondary text-xs",onClick:()=>j(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary text-xs",onClick:T,children:[e.jsx(me,{className:"h-3 w-3"})," Save"]})]}),e.jsx("button",{className:"btn-primary text-xs",onClick:()=>g.mutate(),disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3 animate-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3"})," AI Report"]})}),!w&&e.jsxs("button",{className:"btn-secondary text-xs",onClick:S,children:[e.jsx(he,{className:"h-3 w-3"})," Quick"]})]})]}),g.isError&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-yellow-900/10 border border-yellow-700/30 rounded-lg text-xs text-yellow-300",children:[e.jsx(ge,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["AI unavailable. ",e.jsx("button",{className:"underline",onClick:S,children:"Use quick report"})]})]}),F?e.jsx("textarea",{ref:b,value:t,onChange:a=>_(a.target.value),className:"w-full bg-dark-900 text-dark-200 font-mono text-xs p-3 focus:outline-none rounded-lg resize-y border border-dark-700",style:{minHeight:"300px"},spellCheck:!1}):w?e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:M(w)}):e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(V,{className:"h-10 w-10 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No report yet. Generate one to get started."})]})]})}export{Se as default};
//# sourceMappingURL=Workspaces-fhbhf_sz.js.map
