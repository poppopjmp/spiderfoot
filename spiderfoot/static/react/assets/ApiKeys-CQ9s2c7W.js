import{c as q,I as U,r,J as P,j as e,Y as H,p as Y,X as M,K as $,t as Q,M as g,T as X,e as V,Q as G,v as W,_ as Z,z as ee,d as se}from"./index-DRNKMmPJ.js";import{P as te}from"./plus-CVVjuQd7.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=q("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),J=["viewer","analyst","operator","admin"],T={admin:"bg-red-500/15 text-red-400 border-red-500/30",operator:"bg-orange-500/15 text-orange-400 border-orange-500/30",analyst:"bg-blue-500/15 text-blue-400 border-blue-500/30",viewer:"bg-dark-600/50 text-dark-300 border-dark-600"},D={active:{icon:e.jsx(G,{className:"h-3.5 w-3.5 text-green-400"}),color:"text-green-400"},revoked:{icon:e.jsx(B,{className:"h-3.5 w-3.5 text-red-400"}),color:"text-red-400"},expired:{icon:e.jsx(V,{className:"h-3.5 w-3.5 text-yellow-400"}),color:"text-yellow-400"}};function ae(t){return t?new Date(t*1e3).toLocaleString():"—"}function re(t){if(!t)return"Never";const a=Date.now()/1e3-t;return a<60?"Just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`}function z(t){if(!t)return"Never";const a=t-Date.now()/1e3;return a<0?"Expired":a<86400?`${Math.floor(a/3600)}h left`:`${Math.floor(a/86400)}d left`}function ce(){const{user:t,hasPermission:a}=U(),o=a("user:read"),[d,x]=r.useState([]),[m,p]=r.useState(!0),[u,h]=r.useState(""),[f,L]=r.useState(""),[w,A]=r.useState(!1),[y,E]=r.useState(null),[v,j]=r.useState(null),[C,b]=r.useState(null),N=r.useCallback(async()=>{var s,n;p(!0),h("");try{const i=o?"/api/auth/api-keys":"/api/auth/api-keys/mine",c=await P.get(i);x(c.data.items||[])}catch(i){h(((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.detail)||i.message||"Failed to load API keys")}finally{p(!1)}},[o]);r.useEffect(()=>{N()},[N]);const I=d.filter(s=>{if(!f)return!0;const n=f.toLowerCase();return s.name.toLowerCase().includes(n)||s.key_prefix.toLowerCase().includes(n)||s.role.toLowerCase().includes(n)||s.status.toLowerCase().includes(n)}),R=async s=>{var n,i;try{await P.post(`/api/auth/api-keys/${s.id}/revoke`),N(),b(null)}catch(c){h(((i=(n=c.response)==null?void 0:n.data)==null?void 0:i.detail)||"Failed to revoke key")}},l=async s=>{var n,i;try{await P.delete(`/api/auth/api-keys/${s.id}`),N(),j(null)}catch(c){h(((i=(n=c.response)==null?void 0:n.data)==null?void 0:i.detail)||"Failed to delete key")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(H,{className:"h-7 w-7 text-spider-400"}),"API Keys"]}),e.jsx("p",{className:"text-dark-400 text-sm mt-1",children:"Generate API keys for programmatic access with fine-grained permissions"})]}),e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-4 py-2 bg-spider-600 hover:bg-spider-500 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(te,{className:"h-4 w-4"}),"Generate Key"]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500"}),e.jsx("input",{type:"text",placeholder:"Search keys...",value:f,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-10 py-2.5 bg-dark-800 border border-dark-700 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60"}),f&&e.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-dark-500 hover:text-dark-300",children:e.jsx(M,{className:"h-4 w-4"})})]}),u&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 px-4 py-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx($,{className:"h-4 w-4 flex-shrink-0"}),u,e.jsx("button",{onClick:()=>h(""),className:"ml-auto text-red-500 hover:text-red-300",children:e.jsx(M,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"bg-dark-800 border border-dark-700 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700 text-dark-400 text-left",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Key Prefix"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Role"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Permissions"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Last Used"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Expires"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-12 text-center text-dark-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-spider-500 border-t-transparent rounded-full"}),"Loading API keys..."]})})}):I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-12 text-center text-dark-500",children:f?"No keys match your search":'No API keys yet. Click "Generate Key" to create one.'})}):I.map(s=>{const n=D[s.status]||D.active,i=s.allowed_modules?JSON.parse(s.allowed_modules):[],c=s.expires_at>0&&s.expires_at<Date.now()/1e3;return e.jsxs("tr",{className:"border-b border-dark-700/50 hover:bg-dark-750 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"text-white font-medium",children:s.name}),e.jsx("p",{className:"text-dark-500 text-xs",children:ae(s.created_at)})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("code",{className:"text-dark-300 font-mono text-xs bg-dark-900 px-2 py-0.5 rounded",children:[s.key_prefix,"..."]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:g("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium border",T[s.role]||T.viewer),children:[e.jsx(Q,{className:"h-3 w-3"}),s.role]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[c?D.expired.icon:n.icon,e.jsx("span",{className:g("capitalize",c?"text-yellow-400":n.color),children:c?"expired":s.status})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"space-y-0.5",children:[i.length>0?e.jsxs("p",{className:"text-xs text-dark-400",children:[i.length," module",i.length!==1?"s":""]}):e.jsx("p",{className:"text-xs text-dark-500",children:"All modules"}),s.rate_limit>0&&e.jsxs("p",{className:"text-xs text-dark-500",children:[s.rate_limit," req/min"]})]})}),e.jsx("td",{className:"px-4 py-3 text-dark-400 text-xs",children:re(s.last_used)}),e.jsx("td",{className:"px-4 py-3 text-dark-400 text-xs",children:z(s.expires_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[s.status==="active"&&e.jsx("button",{onClick:()=>b(s),className:"p-1.5 text-dark-500 hover:text-yellow-400 hover:bg-dark-700 rounded-lg transition-colors",title:"Revoke key",children:e.jsx(B,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>j(s),className:"p-1.5 text-dark-500 hover:text-red-400 hover:bg-dark-700 rounded-lg transition-colors",title:"Delete key",children:e.jsx(X,{className:"h-3.5 w-3.5"})})]})})]},s.id)})})]})})}),w&&e.jsx(ne,{userRole:(t==null?void 0:t.role)||"viewer",onClose:()=>A(!1),onCreated:s=>{A(!1),E(s),N()}}),y&&e.jsx(ie,{apiKey:y,onClose:()=>E(null)}),C&&e.jsx(F,{title:"Revoke API Key",message:e.jsxs(e.Fragment,{children:["Are you sure you want to revoke ",e.jsx("span",{className:"text-white font-medium",children:C.name}),"? The key will immediately stop working."]}),confirmLabel:"Revoke",confirmClass:"bg-yellow-600 hover:bg-yellow-500",onConfirm:()=>R(C),onClose:()=>b(null)}),v&&e.jsx(F,{title:"Delete API Key",message:e.jsxs(e.Fragment,{children:["Are you sure you want to permanently delete ",e.jsx("span",{className:"text-white font-medium",children:v.name}),"? This cannot be undone."]}),confirmLabel:"Delete",confirmClass:"bg-red-600 hover:bg-red-500",onConfirm:()=>l(v),onClose:()=>j(null)})]})}function O({title:t,onClose:a,children:o,wide:d}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:g("relative bg-dark-800 border border-dark-700 rounded-2xl p-6 shadow-2xl animate-fade-in-up max-h-[90vh] overflow-y-auto",d?"max-w-2xl w-full":"max-w-lg w-full"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:t}),e.jsx("button",{onClick:a,className:"text-dark-500 hover:text-dark-300 transition-colors",children:e.jsx(M,{className:"h-5 w-5"})})]}),o]})]})}function S({label:t,hint:a,children:o}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300",children:t}),o,a&&e.jsx("p",{className:"text-xs text-dark-500",children:a})]})}const _="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60",le="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60 appearance-none";function ne({userRole:t,onClose:a,onCreated:o}){const[d,x]=r.useState(""),[m,p]=r.useState(t),[u,h]=r.useState(90),[f,L]=r.useState(0),[w,A]=r.useState(""),[y,E]=r.useState(""),[v,j]=r.useState(!1),[C,b]=r.useState(""),N=J.indexOf(t),I=J.slice(0,N>=0?N+1:1),R=async l=>{var i,c;l.preventDefault(),j(!0),b("");let s="";if(w.trim())try{const k=w.includes("[")?JSON.parse(w):w.split(",").map(K=>K.trim()).filter(Boolean);s=JSON.stringify(k)}catch{b("Allowed modules must be comma-separated names or a JSON array"),j(!1);return}let n="";if(y.trim())try{const k=y.includes("[")?JSON.parse(y):y.split(",").map(K=>K.trim()).filter(Boolean);n=JSON.stringify(k)}catch{b("Allowed endpoints must be comma-separated patterns or a JSON array"),j(!1);return}try{const k=await P.post("/api/auth/api-keys",{name:d,role:m,expires_in_days:u,rate_limit:f,allowed_modules:s,allowed_endpoints:n});o(k.data)}catch(k){b(((c=(i=k.response)==null?void 0:i.data)==null?void 0:c.detail)||"Failed to create API key")}finally{j(!1)}};return e.jsx(O,{title:"Generate API Key",onClose:a,wide:!0,children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx($,{className:"h-4 w-4 flex-shrink-0"}),C]}),e.jsx(S,{label:"Key Name",hint:"A descriptive name for this key (e.g. 'CI/CD Pipeline', 'Monitoring Script')",children:e.jsx("input",{type:"text",value:d,onChange:l=>x(l.target.value),required:!0,className:_,placeholder:"My API Key"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(S,{label:"Role",hint:"Maximum permission level for this key",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:m,onChange:l=>p(l.target.value),className:le,children:I.map(l=>e.jsx("option",{value:l,children:l.charAt(0).toUpperCase()+l.slice(1)},l))}),e.jsx(W,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none"})]})}),e.jsx(S,{label:"Expires In (days)",hint:"0 = never expires",children:e.jsx("input",{type:"number",value:u,onChange:l=>h(parseInt(l.target.value)||0),min:0,className:_})})]}),e.jsx(S,{label:"Rate Limit (requests/min)",hint:"0 = unlimited",children:e.jsx("input",{type:"number",value:f,onChange:l=>L(parseInt(l.target.value)||0),min:0,className:_})}),e.jsxs("div",{className:"pt-2 border-t border-dark-700/50",children:[e.jsx("p",{className:"text-xs text-dark-500 font-medium uppercase tracking-wider mb-3",children:"Fine-Grained Access Control"}),e.jsx(S,{label:"Allowed Modules",hint:"Comma-separated module names (empty = all modules accessible). e.g. sfp_dns,sfp_whois,sfp_shodan",children:e.jsx("textarea",{value:w,onChange:l=>A(l.target.value),rows:2,className:g(_,"font-mono text-xs"),placeholder:"sfp_dns, sfp_whois, sfp_shodan"})}),e.jsx("div",{className:"mt-3",children:e.jsx(S,{label:"Allowed API Endpoints",hint:"Comma-separated URL patterns (empty = all endpoints). e.g. /api/scans/*, /api/data/*",children:e.jsx("textarea",{value:y,onChange:l=>E(l.target.value),rows:2,className:g(_,"font-mono text-xs"),placeholder:"/api/scans/*, /api/data/*"})})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v||!d.trim(),className:"px-4 py-2 bg-spider-600 hover:bg-spider-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:v?"Generating...":"Generate Key"})]})]})})}function ie({apiKey:t,onClose:a}){const[o,d]=r.useState(!1),[x,m]=r.useState(!1),p=()=>{t.key&&(navigator.clipboard.writeText(t.key),d(!0),setTimeout(()=>d(!1),2e3))};return e.jsx(O,{title:"API Key Created",onClose:a,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"px-4 py-3 bg-green-500/5 border border-green-500/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm font-medium mb-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Key generated successfully"]}),e.jsxs("p",{className:"text-xs text-dark-400 mb-3",children:["Copy this key now — it will ",e.jsx("span",{className:"text-white font-medium",children:"not be shown again"}),"."]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:g("flex-1 text-xs font-mono px-3 py-2 bg-dark-900 border border-dark-700 rounded-lg",x?"text-green-300":"text-dark-500"),children:x?t.key:"••••••••••••••••••••••••••••••••"}),e.jsx("button",{onClick:()=>m(!x),className:"p-2 text-dark-500 hover:text-dark-300 transition-colors",title:x?"Hide":"Reveal",children:x?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:p,className:g("p-2 rounded-lg transition-colors",o?"text-green-400 bg-green-500/10":"text-dark-500 hover:text-dark-300 hover:bg-dark-700"),title:"Copy to clipboard",children:e.jsx(se,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Name"}),e.jsx("span",{className:"text-white",children:t.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Role"}),e.jsx("span",{className:"text-white capitalize",children:t.role})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Prefix"}),e.jsx("code",{className:"text-dark-300 font-mono text-xs",children:t.key_prefix})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Expires"}),e.jsx("span",{className:"text-white",children:z(t.expires_at)})]})]}),e.jsxs("div",{className:"bg-dark-900/50 border border-dark-700 rounded-lg p-3 text-xs text-dark-400",children:[e.jsx("p",{className:"font-medium text-dark-300 mb-1",children:"Usage Example:"}),e.jsx("code",{className:"block text-dark-500 whitespace-pre-wrap",children:`curl -H "Authorization: Bearer ${t.key||"sf_xxxx_..."}" \\
     ${window.location.origin}/api/scans`})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-spider-600 hover:bg-spider-500 text-white rounded-lg text-sm font-medium transition-colors",children:"Done"})})]})})}function F({title:t,message:a,confirmLabel:o,confirmClass:d,onConfirm:x,onClose:m}){const[p,u]=r.useState(!1),h=async()=>{u(!0),await x(),u(!1)};return e.jsx(O,{title:t,onClose:m,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-300 text-sm",children:a}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:p,className:g("px-4 py-2 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",d),children:p?"Processing...":o})]})]})})}export{ce as default};
//# sourceMappingURL=ApiKeys-CQ9s2c7W.js.map
