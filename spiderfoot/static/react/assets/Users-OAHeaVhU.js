import{c as I,I as B,r as s,J as E,j as e,U as J,p as K,X as O,K as L,t as X,M as G,N as Q,T as H,e as V,A as W,O as Y,Q as Z,v as _}from"./index-DEeuZvqM.js";import{P as ee}from"./plus-DLTwKxQB.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=I("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),z=["viewer","analyst","operator","admin"],te=["active","disabled","locked","pending"],F={active:e.jsx(Z,{className:"h-3.5 w-3.5 text-green-400"}),disabled:e.jsx(Y,{className:"h-3.5 w-3.5 text-dark-500"}),locked:e.jsx(W,{className:"h-3.5 w-3.5 text-red-400"}),pending:e.jsx(V,{className:"h-3.5 w-3.5 text-yellow-400"})},q={admin:"bg-red-500/15 text-red-400 border-red-500/30",operator:"bg-orange-500/15 text-orange-400 border-orange-500/30",analyst:"bg-blue-500/15 text-blue-400 border-blue-500/30",viewer:"bg-dark-600/50 text-dark-300 border-dark-600"};function $(t){return t?new Date(t*1e3).toLocaleString():"—"}function oe(){const{user:t,hasPermission:n}=B(),u=n("user:create"),d=n("user:update"),j=n("user:delete"),[c,g]=s.useState([]),[h,m]=s.useState(0),[p,x]=s.useState(!0),[N,i]=s.useState(""),[o,b]=s.useState(""),[v,a]=s.useState(!1),[l,y]=s.useState(null),[k,S]=s.useState(null),[M,A]=s.useState(null),U=s.useCallback(async()=>{var r,C;x(!0),i("");try{const D=await E.get("/api/auth/users",{params:{limit:200,offset:0}});g(D.data.items||[]),m(D.data.total||0)}catch(D){i(((C=(r=D.response)==null?void 0:r.data)==null?void 0:C.detail)||D.message||"Failed to load users")}finally{x(!1)}},[]);s.useEffect(()=>{U()},[U]);const T=c.filter(r=>{if(!o)return!0;const C=o.toLowerCase();return r.username.toLowerCase().includes(C)||r.email.toLowerCase().includes(C)||r.display_name.toLowerCase().includes(C)||r.role.toLowerCase().includes(C)});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(J,{className:"h-7 w-7 text-spider-400"}),"User Management"]}),e.jsxs("p",{className:"text-dark-400 text-sm mt-1",children:[h," user",h!==1?"s":""," total"]})]}),u&&e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-spider-600 hover:bg-spider-500 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(ee,{className:"h-4 w-4"}),"Add User"]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:o,onChange:r=>b(r.target.value),className:"w-full pl-10 pr-10 py-2.5 bg-dark-800 border border-dark-700 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60"}),o&&e.jsx("button",{onClick:()=>b(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-dark-500 hover:text-dark-300",children:e.jsx(O,{className:"h-4 w-4"})})]}),N&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 px-4 py-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(L,{className:"h-4 w-4 flex-shrink-0"}),N]}),e.jsx("div",{className:"bg-dark-800 border border-dark-700 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700 text-dark-400 text-left",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"User"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Role"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Auth"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Last Login"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-dark-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-spider-500 border-t-transparent rounded-full"}),"Loading users..."]})})}):T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-dark-500",children:o?"No users match your search":"No users found"})}):T.map(r=>e.jsxs("tr",{className:"border-b border-dark-700/50 hover:bg-dark-750 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:r.display_name||r.username}),e.jsx("p",{className:"text-dark-500 text-xs",children:r.email||r.username})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:G("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium border",q[r.role]||q.viewer),children:[e.jsx(X,{className:"h-3 w-3"}),r.role]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[F[r.status]||F.pending,e.jsx("span",{className:"text-dark-300 capitalize",children:r.status})]})}),e.jsx("td",{className:"px-4 py-3 text-dark-400 capitalize",children:r.auth_method}),e.jsx("td",{className:"px-4 py-3 text-dark-400 text-xs",children:$(r.last_login)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[d&&e.jsx("button",{onClick:()=>y(r),className:"p-1.5 text-dark-500 hover:text-spider-400 hover:bg-dark-700 rounded-lg transition-colors",title:"Edit user",children:e.jsx(se,{className:"h-3.5 w-3.5"})}),d&&e.jsx("button",{onClick:()=>S(r),className:"p-1.5 text-dark-500 hover:text-yellow-400 hover:bg-dark-700 rounded-lg transition-colors",title:"Change password",children:e.jsx(Q,{className:"h-3.5 w-3.5"})}),j&&r.id!==(t==null?void 0:t.id)&&e.jsx("button",{onClick:()=>A(r),className:"p-1.5 text-dark-500 hover:text-red-400 hover:bg-dark-700 rounded-lg transition-colors",title:"Delete user",children:e.jsx(H,{className:"h-3.5 w-3.5"})})]})})]},r.id))})]})})}),v&&e.jsx(ae,{onClose:()=>a(!1),onCreated:()=>{a(!1),U()}}),l&&e.jsx(re,{user:l,onClose:()=>y(null),onUpdated:()=>{y(null),U()}}),k&&e.jsx(le,{user:k,onClose:()=>S(null),onChanged:()=>{S(null)}}),M&&e.jsx(ne,{user:M,onClose:()=>A(null),onDeleted:()=>{A(null),U()}})]})}function P({title:t,onClose:n,children:u}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-dark-800 border border-dark-700 rounded-2xl p-6 max-w-lg w-full shadow-2xl animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:t}),e.jsx("button",{onClick:n,className:"text-dark-500 hover:text-dark-300 transition-colors",children:e.jsx(O,{className:"h-5 w-5"})})]}),u]})]})}function f({label:t,children:n}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300",children:t}),n]})}const w="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white placeholder:text-dark-500 focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60",R="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-spider-500/40 focus:border-spider-500/60 appearance-none";function ae({onClose:t,onCreated:n}){const[u,d]=s.useState(""),[j,c]=s.useState(""),[g,h]=s.useState(""),[m,p]=s.useState("viewer"),[x,N]=s.useState(""),[i,o]=s.useState(!1),[b,v]=s.useState(""),a=async l=>{var y,k;l.preventDefault(),o(!0),v("");try{await E.post("/api/auth/users",{username:u,email:j,password:g,role:m,display_name:x}),n()}catch(S){v(((k=(y=S.response)==null?void 0:y.data)==null?void 0:k.detail)||"Failed to create user")}finally{o(!1)}};return e.jsx(P,{title:"Create User",onClose:t,children:e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[b&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(L,{className:"h-4 w-4 flex-shrink-0"}),b]}),e.jsx(f,{label:"Username",children:e.jsx("input",{type:"text",value:u,onChange:l=>d(l.target.value),required:!0,className:w,placeholder:"e.g. john.doe"})}),e.jsx(f,{label:"Email",children:e.jsx("input",{type:"email",value:j,onChange:l=>c(l.target.value),required:!0,className:w,placeholder:"john@example.com"})}),e.jsx(f,{label:"Password",children:e.jsx("input",{type:"password",value:g,onChange:l=>h(l.target.value),required:!0,minLength:8,className:w,placeholder:"Min 8 characters"})}),e.jsx(f,{label:"Display Name",children:e.jsx("input",{type:"text",value:x,onChange:l=>N(l.target.value),className:w,placeholder:"John Doe"})}),e.jsx(f,{label:"Role",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:m,onChange:l=>p(l.target.value),className:R,children:z.map(l=>e.jsx("option",{value:l,children:l.charAt(0).toUpperCase()+l.slice(1)},l))}),e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-spider-600 hover:bg-spider-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:i?"Creating...":"Create User"})]})]})})}function re({user:t,onClose:n,onUpdated:u}){const[d,j]=s.useState(t.email),[c,g]=s.useState(t.role),[h,m]=s.useState(t.display_name),[p,x]=s.useState(t.status),[N,i]=s.useState(!1),[o,b]=s.useState(""),v=async a=>{var l,y;a.preventDefault(),i(!0),b("");try{await E.patch(`/api/auth/users/${t.id}`,{email:d,role:c,display_name:h,status:p}),u()}catch(k){b(((y=(l=k.response)==null?void 0:l.data)==null?void 0:y.detail)||"Failed to update user")}finally{i(!1)}};return e.jsx(P,{title:`Edit ${t.username}`,onClose:n,children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[o&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(L,{className:"h-4 w-4 flex-shrink-0"}),o]}),e.jsx(f,{label:"Email",children:e.jsx("input",{type:"email",value:d,onChange:a=>j(a.target.value),className:w})}),e.jsx(f,{label:"Display Name",children:e.jsx("input",{type:"text",value:h,onChange:a=>m(a.target.value),className:w})}),e.jsx(f,{label:"Role",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:c,onChange:a=>g(a.target.value),className:R,children:z.map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none"})]})}),e.jsx(f,{label:"Status",children:e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:p,onChange:a=>x(a.target.value),className:R,children:te.map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dark-500 pointer-events-none"})]})}),e.jsxs("div",{className:"text-xs text-dark-500 space-y-1",children:[e.jsxs("p",{children:["Auth method: ",e.jsx("span",{className:"text-dark-300",children:t.auth_method})]}),e.jsxs("p",{children:["Created: ",e.jsx("span",{className:"text-dark-300",children:$(t.created_at)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-spider-600 hover:bg-spider-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:N?"Saving...":"Save Changes"})]})]})})}function le({user:t,onClose:n,onChanged:u}){const[d,j]=s.useState(""),[c,g]=s.useState(""),[h,m]=s.useState(!1),[p,x]=s.useState(""),N=async i=>{var o,b;if(i.preventDefault(),d!==c){x("Passwords do not match");return}m(!0),x("");try{await E.post(`/api/auth/users/${t.id}/password`,{new_password:d}),u()}catch(v){x(((b=(o=v.response)==null?void 0:o.data)==null?void 0:b.detail)||"Failed to change password")}finally{m(!1)}};return e.jsx(P,{title:`Change Password — ${t.username}`,onClose:n,children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[p&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(L,{className:"h-4 w-4 flex-shrink-0"}),p]}),e.jsx(f,{label:"New Password",children:e.jsx("input",{type:"password",value:d,onChange:i=>j(i.target.value),required:!0,minLength:8,className:w,placeholder:"Min 8 characters"})}),e.jsx(f,{label:"Confirm Password",children:e.jsx("input",{type:"password",value:c,onChange:i=>g(i.target.value),required:!0,minLength:8,className:w,placeholder:"Re-enter password"})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||d.length<8||d!==c,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:h?"Changing...":"Change Password"})]})]})})}function ne({user:t,onClose:n,onDeleted:u}){const[d,j]=s.useState(!1),[c,g]=s.useState(""),h=async()=>{var m,p;j(!0),g("");try{await E.delete(`/api/auth/users/${t.id}`),u()}catch(x){g(((p=(m=x.response)==null?void 0:m.data)==null?void 0:p.detail)||"Failed to delete user"),j(!1)}};return e.jsx(P,{title:"Delete User",onClose:n,children:e.jsxs("div",{className:"space-y-4",children:[c&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(L,{className:"h-4 w-4 flex-shrink-0"}),c]}),e.jsxs("p",{className:"text-dark-300 text-sm",children:["Are you sure you want to delete user"," ",e.jsx("span",{className:"text-white font-medium",children:t.username}),"? This action cannot be undone and will revoke all active sessions."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:d,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:d?"Deleting...":"Delete User"})]})]})})}export{oe as default};
//# sourceMappingURL=Users-OAHeaVhU.js.map
